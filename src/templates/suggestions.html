{% extends "base.html" %}

{% block title %}Predlogi in komentar{% endblock %}

{% block content %}
<div style="background: linear-gradient(135deg, #8a9fff 0%, #ff6e6e 100%); min-height: 100vh; padding: 60px 0;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Header -->
                <div class="text-center text-white mb-5">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üí°</div>
                    <h1 class="display-5 fw-bold">Va≈°i predlogi so dragoceni</h1>
                    <p class="lead">Po≈°ljite svoje ideje za izbolj≈°ave in povratne informacije</p>
                </div>

                <!-- Form Card -->
                <div class="card border-0 shadow-lg rounded-3 overflow-hidden mb-4">
                    <div class="card-body p-5">
                        <h2 class="h4 mb-4">Po≈°lji svoj predlog</h2>
                        
                        <form id="suggestionForm" onsubmit="submitSuggestion(event)">
                            <div class="mb-4">
                                <label for="suggestionType" class="form-label fw-semibold">Vrsta predloga</label>
                                <select id="suggestionType" name="type" class="form-select form-select-lg" required>
                                    <option value="">-- Izberi vrsto --</option>
                                    <option value="predlog za film">üé¨ Predlog filma/risanke</option>
                                    <option value="predlog za glasbo">üéµ Predlog pesmi</option>
                                    <option value="nova funkcionalnost">‚ú® Ideja za novo funkcionalnost</option>
                                    <option value="izboljsava">üîß Predlog za izbolj≈°avo</option>
                                    <option value="napaka">üêõ Poroƒçilo o napaki</option>
                                    <option value="komentar">üí¨ Drug komentar</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label for="suggestionText" class="form-label fw-semibold">Tvoj predlog</label>
                                <textarea id="suggestionText" name="suggestion" class="form-control form-control-lg" required minlength="10" rows="6" placeholder="Napi≈°ite svoj predlog ali idejo..."></textarea>
                                <small class="text-muted d-block mt-2">Najmanj 10 znakov</small>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg rounded-2 fw-bold">
                                    <i class="bi bi-send me-2"></i>Po≈°lji predlog
                                </button>
                            </div>

                            <div id="suggestionStatus" class="status-message mt-3"></div>
                        </form>
                    </div>
                </div>

                <!-- Info Card -->
                <div class="card border-0 shadow-lg rounded-3 overflow-hidden" style="background: linear-gradient(135deg, #fcffd9 0%, #faeee3 100%); border: 2px solid #4caf50;">
                    <div class="card-body p-4 text-center">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üé¨</div>
                        <h3 class="h5 mb-2">Hvala za povratne informacije!</h3>
                        <p class="mb-0 text-muted">Vsak predlog je dragocen in mi pomaga, da MarinKino izbolj≈°am.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-select, .form-control {
        border: 1px solid #ddd;
        background-color: #f8f9fa;
    }

    .form-select:focus, .form-control:focus {
        border-color: #667eea;
        background-color: #fff;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .status-message {
        padding: 1rem;
        border-radius: 0.5rem;
        display: none;
        animation: slideIn 0.3s ease-out;
    }

    .status-message.success {
        display: block;
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .status-message.error {
        display: block;
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .rounded-3 { border-radius: 1rem; }
    .rounded-2 { border-radius: 0.5rem; }
</style>

<script>
function submitSuggestion(event) {
    event.preventDefault();
    
    const comment_type = document.getElementById('suggestionType').value;
    const text = document.getElementById('suggestionText').value.trim();
    const statusDiv = document.getElementById('suggestionStatus');
    
    if (!comment_type || !text) {
        statusDiv.className = 'status-message error';
        statusDiv.textContent = '‚ùå Prosim izpolnite vsa polja.';
        return;
    }
    
    const data = {
        comment_type: comment_type,
        movieFolder: "Splo≈°no",
        comment: text
    };
    
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    
    fetch('/movies/add-comment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            "X-CSRFToken": csrfToken
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.status === 'success') {
            statusDiv.className = 'status-message success';
            statusDiv.textContent = '‚úì Hvala! Tvoj predlog je bil uspe≈°no poslan. Administrator ga bo kmalu pregledal.';
            document.getElementById('suggestionForm').reset();
            
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = 'status-message';
            }, 5000);
        } else {
            statusDiv.className = 'status-message error';
            statusDiv.textContent = '‚ùå Napaka: ' + result.message;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        statusDiv.className = 'status-message error';
        statusDiv.textContent = '‚ùå Napaka pri po≈°iljanju predloga. Poskusite ponovno.';
    });
}
</script>
{% endblock %}
